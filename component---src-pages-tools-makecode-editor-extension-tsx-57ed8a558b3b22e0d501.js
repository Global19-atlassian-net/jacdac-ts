(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{"2RYT":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return W}));var r=n("q1tI"),a=n.n(r),i=n("ZBNC"),s=n("viY9"),c=n("q4d2"),o=n("L1J+"),u=n("kD0k"),d=n.n(u),l=(n("ls82"),n("/S4K")),m=n("tRbT"),f=n("r9w1"),h=n("eNf+"),p=n("IzqI"),v=n("FrwU"),b=n.n(v),x=n("ZF4C"),g=n("T7k7"),w=n("8uQ5"),k=n("MpiI"),j=n("POFd"),O=n("ls4f"),E=n("uRdJ"),y=n("9Hrx"),q=n("LBfC"),R=n("sP+f"),I=n("9mRT"),C=n("mr3+"),S=n("2Qkp"),M=function(e){Object(y.a)(n,e);var t=n.prototype;function n(){var t;return(t=e.call(this)||this).pendingCommands={},t.extensionId=Object(I.b)()?window.location.hash.substr(1):void 0,t._connected=!1,t._visible=!1,t.nextRequestId=1,t.handleMessage=t.handleMessage.bind(Object(E.a)(t)),"undefined"!=typeof window&&(window.addEventListener("message",t.handleMessage,!1),t.mount((function(){return window.removeEventListener("message",t.handleMessage)}))),t.on("shown",(function(){return t.refresh()})),t.init(),t}return t.log=function(e){console.log("mkcd "+this.extensionId+": "+e)},t.setVisible=function(e){this._visible!==e&&(this._visible=e,this.emit(R.e))},t.mkRequest=function(e,t,n,r){var a="jd_"+this.nextRequestId++;return this.pendingCommands[a]={action:n,resolve:e,reject:t},{type:"pxtpkgext",action:n,extId:this.extensionId,response:!0,id:a,body:r}},t.sendRequest=function(e,t){var n=this;return this.log("send "+e),this.extensionId?new Promise((function(r,a){var i=n.mkRequest(r,a,e,t);window.parent.postMessage(i,"*")})):Promise.resolve(void 0)},t.handleMessage=function(e){var t=e.data;if("pxtpkgext"===(null==t?void 0:t.type))if(t.id){var n=this.pendingCommands[t.id],r=n.action,a=n.resolve,i=n.reject;switch(delete this.pendingCommands[t.id],t.success&&a?a(t.resp):!t.success&&i&&i(t.resp),r){case"extinit":this._connected=!0,this.emit(R.n),this.emit(R.e);break;case"extusercode":this.emit("readuser",t.resp),this.emit(R.e);break;case"extreadcode":this.emit("read",t.resp),this.emit(R.e);break;case"extwritecode":this.emit("written",void 0)}}else switch(t.event){case"extinit":this.log("init"),this._target=t.target,this._connected=!0,this.emit(R.n),this.emit(R.e);break;case"extloaded":this.log("loaded");break;case"extshown":this.setVisible(!0),this.emit("shown"),this.emit(R.e);break;case"exthidden":this.setVisible(!1),this.emit("hidden"),this.emit(R.e);break;case"extdatastream":this.emit("datastream",!0);break;case"extconsole":this.emit("console",t.body);break;case"extmessagepacket":this.emit("messagepacket",t.body);break;default:console.debug("Unhandled event",t)}},t.init=function(){var e=Object(l.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("initializing"),e.next=3,this.sendRequest("extinit");case 3:return this.log("connected"),e.next=6,this.refresh();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.refresh=function(){var e=Object(l.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("refresh"),e.next=3,this.read();case 3:e.sent;case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.read=function(){var e=Object(l.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.extensionId){e.next=6;break}return t={},this.emit("read",t),e.abrupt("return",t);case 6:return e.next=8,this.sendRequest("extreadcode");case 8:return n=e.sent,e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.readUser=function(){var e=Object(l.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendRequest("extusercode");case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.write=function(){var e=Object(l.a)(d.a.mark((function e(t,n,r,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.extensionId){e.next=4;break}this.emit("written",void 0),e.next=6;break;case 4:return e.next=6,this.sendRequest("extwritecode",{code:t||void 0,json:n||void 0,jres:r||void 0,dependencies:a});case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),t.queryPermission=function(){var e=Object(l.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendRequest("extquerypermission");case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.requestPermission=function(){var e=Object(l.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendRequest("extrequestpermission",{console:t});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.dataStreamConsole=function(){var e=Object(l.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendRequest("extdatastream",{console:t});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.dataStreamMessages=function(){var e=Object(l.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendRequest("extdatastream",{messages:t});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),Object(O.a)(n,[{key:"target",get:function(){return this._target}},{key:"connected",get:function(){return this._connected}},{key:"visible",get:function(){return this._visible}}]),n}(q.a);var _=n("mv/Z"),P=n("hQyO"),N=n.n(P),U=n("gmkF");function F(e){var t="myModules";return"// auto-generated, do not edit.\nnamespace "+t+" {\n"+e.roles.map((function(e){return'\n    //% fixedInstance block="'+e.name+'"\n    export const '+Object(U.c)(e.name)+" = new "+Object(x.x)(e.service).client.qName+'("'+Object(U.c)(e.name)+'");\n'})).join("")+"\n\n    // start after main\n    control.runInParallel(function() {\n        "+e.roles.map((function(e){return"    "+t+"."+Object(U.c)(e.name)+".start();\n        "})).join("")+"\n    })\n}\n    "}function J(e){var t={};return null==e||e.roles.forEach((function(e){var n=Object(x.x)(e.service);t[n.client.name]="github:"+n.client.repo})),t}function T(e){var t=e.component,n=e.onUpdate,i=e.config,s=t.name,c=t.service,o=Object(r.useMemo)((function(){return{serviceError:void 0,nameError:void 0}}),[i,t]),u=o.nameError,d=o.serviceError;return a.a.createElement(m.a,{item:!0,xs:12},a.a.createElement(m.a,{container:!0,spacing:2},a.a.createElement(m.a,{item:!0,xs:4,md:6},a.a.createElement(f.a,{fullWidth:!0,error:!!u,variant:"outlined",label:"name",helperText:u,value:s,onChange:function(e){t.name=Object(k.d)(e.target.value),n()}})),a.a.createElement(m.a,{item:!0,xs:4,md:4},a.a.createElement(w.a,{variant:"outlined",label:"service",serviceClass:c,setServiceClass:function(e){t.service=e,n()},error:d})),a.a.createElement(m.a,{item:!0},a.a.createElement(j.a,{title:"Remove service",onClick:function(){i.roles.splice(i.roles.indexOf(t),1),n()}},a.a.createElement(b.a,null)))))}function B(){var e,t=function(){var e=Object(r.useContext)(S.a).bus,t=Object(r.useState)(void 0),n=t[0],a=t[1];return Object(r.useEffect)((function(){console.log("mkcd: new editor client");var t=new M;return t.on(R.n,(function(){console.log("mkcd: stream messages"),t.dataStreamMessages(!0)})),t.on(["hidden","shown"],(function(){return e.clear()})),t.on("messagepacket",(function(t){if("jacdac"===t.channel&&"jacdac-editor-extension"!==t.source){var n=C.a.fromBinary(t.data,e.timestamp);if(!n)return;n.sender=t.source||"makecode",e.processPacket(n)}})),a(t),function(){return null==t?void 0:t.unmount()}}),[]),n}(),n=Object(p.a)(t,(function(e){return null==e?void 0:e.connected})),i=Object(r.useState)({roles:[]}),s=i[0],c=i[1];Object(r.useEffect)((function(){return null==t?void 0:t.subscribe("read",(function(e){console.log("mkcd: read received");var t=Object(h.b)(e.json);console.log({resp:e,cfg:t}),t&&c(t)}))}),[t]);var o=function(){c(Object(h.m)(s))},u=function(){var e=Object(l.a)(d.a.mark((function e(){var n,r,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=F(s),r=(i=s)&&JSON.stringify(i,null,4),a=J(s),console.log("mkcd: saving..."),e.next=6,t.write(n,r,void 0,a);case 6:case"end":return e.stop()}var i}),e)})));return function(){return e.apply(this,arguments)}}();return a.a.createElement(m.a,{container:!0,direction:"row",spacing:2},null===(e=s.roles)||void 0===e?void 0:e.map((function(e,t){return a.a.createElement(T,{key:"config"+t,config:s,component:e,onUpdate:o})})),a.a.createElement(m.a,{item:!0,xs:12},a.a.createElement(g.a,{serviceFilter:function(e){return!!Object(x.w)(e)},onAdd:function(e){s.roles||(s.roles=[]);var t=s.roles.map((function(e){return e.name})).concat(Object(x.D)().map((function(e){return e.camelName}))).filter((function(e){return!!e}));s.roles.push({name:Object(h.S)(t,e.camelName||e.shortId),service:e.classIdentifier}),o()}})),a.a.createElement(m.a,{item:!0,xs:12},a.a.createElement(_.a,{variant:"contained",disabled:!n,icon:a.a.createElement(N.a,null),onClick:u},"save")))}var L=n("R/WZ"),Z=n("goX9"),D=n("StIp"),Q=n("x4rs"),V=Object(L.a)((function(e){return Object(i.a)({content:{display:"flex",minHeight:"100vh",minWidth:"10rem",flexDirection:"column",padding:e.spacing(3),transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),flexGrow:1}})}));function W(){var e=Object(s.a)({palette:{primary:{main:"#2e7d32"},secondary:{main:"#ffc400"}}}),t=V(),n=Object(c.a)(e);return Object(r.useEffect)((function(){D.a.webUSB=!1}),[]),a.a.createElement(o.a,{theme:n},a.a.createElement("div",{className:t.content},a.a.createElement(Z.a,null,a.a.createElement(B,null)),a.a.createElement(Q.a,null)))}}}]);
//# sourceMappingURL=component---src-pages-tools-makecode-editor-extension-tsx-57ed8a558b3b22e0d501.js.map